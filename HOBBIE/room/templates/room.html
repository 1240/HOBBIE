{% extends 'base.html' %}
{% load dajaxice_templatetags %}
{% load staticfiles %}
{% block rooms %}
    {% dajaxice_js_import %}

    <script type="text/javascript" src="{% static "dajax/jquery.dajax.core.js" %}"></script>
    <script type="text/javascript">
        function refresh() {
            Dajaxice.room.get_messages(Dajax.process, {'room_id': {{ room.id }}});
        }
        function scrolling() {

            document.getElementById('messages_list').scrollTop=9999;
        }
        setInterval(refresh, 2000);

    </script>
    <br/>
    <div>
        <div class="small-8 columns">
            <div class="row">
                <div class="small-3 large-3 columns">
                    <img src="{% static room.room_image %}" class="roomimage">
                </div>
                <br>

                <div class="small-9 large-9 columns">
                    <h3><strong>{{ room.room_title }}</strong></h3>
                </div>
            </div>
            <div class="panel callout radius">
                <p>{{ room.room_text }}</p>
            </div>

            <div>
                <h5><strong>Обсуждение</strong></h5>

                <div id="messages_list">
                    {% for message in messages %}
                        <div class="row">
                            <div class="small-7 medium-8 large-9 columns">
                                <strong><a
                                        href="/account/{{ message.user.username }}/">{{ message.user.username }}</a>:
                                </strong> {{ message.message_text }}
                            </div>
                            <div class="small-5 medium-4 large-3 columns">
                                ({{ message.message_datetime }})
                            </div>
                        </div>
                    {% endfor %}

                </div>
                <hr>
                {% if user in users_in_room %}
                    <div class="row">
                        <div class="large-12 columns">
                            <div class="row collapse">
                                <div class="small-10 columns">
                                        <input type="text" id="message_text" placeholder="Текст сообщения"
                                               maxlength="200"/>
                                </div>
                                <div class="small-2 columns">
                                    <a href="#"
                                       onclick="Dajaxice.room.send_message(Dajax.process,
                                               {'room_id': {{ room.id }},
                                               'message_text':$('#message_text').val()
                                               });
                                               document.getElementById('message_text').value = '';
                                               setTimeout(scrolling,200)"
                                            class="button postfix">
                                        <i class="fa fa-send"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="small-4 columns">

            <div><a href="/rooms/all/" class="button [tiny small large]">Вернуться к списку комнат</a></div>

            {% if user in users_in_room %}
                <div><a href="/rooms/leave/{{ room.id }}/" class="button [tiny small large]">Покинуть</a>
                    <a href="/rooms/invite/{{ room.id }}/" class="button [tiny small large]">Пригласить</a>

                </div>
                {% if is_creator.is_creator %}
                    <div><a href="/rooms/editroom/{{ room.id }}/" class="button [tiny small large]">Редактировать</a>
                    </div>
                {% endif %}
            {% else %}
                <div><a href="/rooms/join/{{ room.id }}/" class="button [tiny small large]">Вступить</a></div>
            {% endif %}
            <div class="panel callout radius">
                <p><strong>Ключевые слова:</strong> {{ room.hash_tags }}</p>
            </div>
            <h4>Информация о комнате</h4>

            <p><strong>Дата мероприятия:</strong>
                {% if room.room_to_date %}
                    {{ room.room_to_date }}
                {% else %}
                    не указана
                {% endif %}
            </p>

            <p>Комнату создал
                <strong> <a href="/account/{{ creator }}/">{{ creator }}</a></strong>
                {{ room.room_create_date }}</p>

            <p>{{ room_region }}</p>

            <p>Комната <strong>{{ openclose }}</strong></p>
            <strong>В комнате </strong> {{ room.room_people_count }} человек:
            {% for user_name in users_in_room %}
                <a href="/account/{{ user_name.username }}/">{{ user_name.username }}</a>
            {% endfor %}

        </div>
    </div>



{% endblock %}
